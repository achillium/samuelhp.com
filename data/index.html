<!DOCTYPE html>
<html lang="en">

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Samuel HP's Data</title>
        <link rel="stylesheet" type="text/css" href="../samuelhp_files/styles.css">
        
        <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
        <link rel="manifest" href="../site.webmanifest">
      <style>
      </style>
		<script src="https://d3js.org/d3.v7.min.js"></script>
    </head>

    <body>
    
    
        <div class="">
	            <div>
	                <a href="../" class="h1link">
	                    <h1 class="title">
	                    SAMUEL HP
	                    </h1>
	                </a>
	            </div>
			    <br/>
			<div>
				<h2 style="white-space: nowrap;">Pomodoros üçÖ</h2>
			</div>
		</div>
		
			<div class="tooltip" id="tooltip"></div>
			<div id="heatmapContainer">
				<svg id="heatmap" width="980" height="160"></svg>
			</div>

			<script>
			const width = 980;
			const cellSize = 12;
			const padding = 4;
			const yearDays = 365;

			const today = new Date();
			const endDate = d3.timeDay.floor(today);
			const startDate = d3.timeDay.offset(endDate, -yearDays + 2);

			const svg = d3.select("#heatmap");
			const tooltip = d3.select("#tooltip");

			d3.csv("./pomodoro/history.csv").then(data => {
			  const counts = d3.rollup(data, v => v.length, d => d["End Date"]);

			  const colorScale = d3.scaleThreshold()
				.domain([1, 2, 3, 5, 10])
								.range(["#ebedf0", "#f8caca", "#ee9999", "#c55a5a", "#c21c1c"]);
								//.range(["#ebedf0", "#9be9a8", "#40c463", "#30a14e", "#216e39"]);

			  const days = d3.timeDays(startDate, d3.timeDay.offset(endDate, 1));
			  const g = svg.append("g").attr("transform", `translate(35, 20)`);

			  // --- Day rectangles ---
			  g.selectAll(".day")
				.data(days)
				.join("rect")
				.attr("class", "day")
				.attr("width", cellSize)
				.attr("height", cellSize)
				.attr("x", d => d3.timeWeek.count(startDate, d) * (cellSize + padding))
				.attr("y", d => d.getDay() * (cellSize + padding))
				.attr("rx", 2).attr("ry", 2)
				.attr("fill", d => {
				  const dateStr = d.toISOString().slice(0, 10);
				  const count = counts.get(dateStr) || 0;
				  return colorScale(count);
				})
				.on("mousemove", function (event, d) {
				  const dateStr = d.toISOString().slice(0, 10);
				  const count = counts.get(dateStr) || 0;
				  tooltip
					.style("opacity", 1)
					.html(`${count} entr${count === 1 ? "y" : "ies"}<br>${dateStr}`)
					.style("left", (event.clientX + 12) + "px")
					.style("top", (event.clientY - 20) + "px");
				})
				.on("mouseout", () => tooltip.style("opacity", 0));

			  // --- Month labels ---
			  g.selectAll(".month-label")
				.data(d3.timeMonths(startDate, endDate))
				.join("text")
				.attr("class", "month-label")
				.attr("x", d => d3.timeWeek.count(startDate, d) * (cellSize + padding))
				.attr("y", -5)
				.text(d3.timeFormat("%b"));

			  // --- Weekday labels (Mon, Wed, Fri only for clean look) ---
			  const weekDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
			  svg.append("g")
				.attr("transform", "translate(25, 26)")
				.selectAll(".week-label")
				.data(weekDays)
				.join("text")
				.attr("class", "week-label")
				.attr("x", 0)
				.attr("y", (d, i) => i * (cellSize + padding) + 9)
				.text(d => (i % 2 === 0 ? d : "")); // label every other line (Sun, Tue, Thu, Sat)
			});

			const hourSvg = d3.select("#heatmapContainer")
				  .append("svg")
				  .attr("id", "hourDistribution")
				  .attr("width", 980)
				  .attr("height", 180);

			d3.csv("./pomodoro/history.csv").then(data => {
			  // Parse hours from "End Date" or "End Time"
			  const parseDate = d3.timeParse("%Y-%m-%d %H:%M:%S");
			  const hourCounts = Array.from({ length: 24 }, () => 0);
			
			  data.forEach(d => {
			    let date = parseDate(d["End Time"]) || parseDate(d["End Date"]);
			    if (!date) return;
			    const hour = date.getHours();
			    hourCounts[hour]++;
			  });
			
			  const maxCount = d3.max(hourCounts);
			  const xScale = d3.scaleBand()
			    .domain(d3.range(24))
			    .range([50, 950])
			    .padding(0.1);
			
			  const yScale = d3.scaleLinear()
			    .domain([0, maxCount])
			    .nice()
			    .range([140, 20]);
			
			  const g = hourSvg.append("g");
			
			  g.selectAll(".bar")
			    .data(hourCounts)
			    .join("rect")
			    .attr("class", "bar")
			    .attr("x", (d, i) => xScale(i))
			    .attr("y", d => yScale(d))
			    .attr("width", xScale.bandwidth())
			    .attr("height", d => 140 - yScale(d))
			    .attr("fill", "green");
			
			  // Axes
			  const xAxis = d3.axisBottom(xScale)
			    .tickFormat(d => {
			      const suffix = d < 12 ? "a" : "p";
			      const hour = d % 12 || 12;
			      return hour + suffix;
			    });
			
			  const yAxis = d3.axisLeft(yScale).ticks(5);
			
			  g.append("g")
			    .attr("transform", "translate(0,140)")
			    .call(xAxis);
			
			  g.append("g")
			    .attr("transform", "translate(50,0)")
			    .call(yAxis);
			
			  g.append("text")
			    .attr("x", 60)
			    .attr("y", 10)
			    .attr("font-weight", "bold")
			    .text("Hourly Distribution");
			});
			</script>
			
        </div>
</body>

</html>
